<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Boost.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lawnlayer</a> &gt; <a href="index.source.html" class="el_package">lawnlayer</a> &gt; <span class="el_source">Boost.java</span></div><h1>Boost.java</h1><pre class="source lang-java linenums">package lawnlayer;

import lawnlayer.Info.Name;
import processing.core.PApplet;
import processing.core.PImage;

/**
 * A singleton subclass of GameObject and implementation of PowerUp.
 * This power up increases the Player's speed for a brief
 * period of time.
 */
public class Boost extends GameObject implements PowerUp {

<span class="fc" id="L14">    private static Boost boost = null;</span>

    private static final int EFFECTDURATION  = 3;
    private static final int SPAWNDURATION = 10;
<span class="fc" id="L18">    private static final int[] SPAWNDELAY = new int[] { 5, 12 };</span>
<span class="fc" id="L19">    private static final int[] RGB = new int[] { 120, 190, 33 };</span>
    
    private boolean isVisible;
    private boolean inEffect;
    private int delay;
    private int stateChangeFrameCount;
    
    /**
     * Initialises the Boost power up with the specified sprite and name.
     * 
     * @param sprite the PImage sprite of the boost
     * @param name the name of the boost
     */
    private Boost(PImage sprite, Name name) {

<span class="fc" id="L34">        super(sprite, name);</span>

<span class="fc" id="L36">        delay = SPAWNDELAY[0] + rand.nextInt(SPAWNDELAY[1] - SPAWNDELAY[0]);</span>
<span class="fc" id="L37">        isVisible = false;</span>
<span class="fc" id="L38">        inEffect = false;</span>
<span class="fc" id="L39">        stateChangeFrameCount = 0;</span>
<span class="fc" id="L40">    }</span>

    /**
     * A 'static constructor' for Player. If multiple instantiation of Player
     * is attempted, an exception is thrown.
     * 
     * @param sprite the PImage sprite of the Boost
     * @param name the name of the boost
     * @return a single instance of Player
     * 
     * @see #Boost(PImage, Name)
     * @throws IllegalStateException if an instance already exists
     */
    public static Boost createBoost(PImage sprite, Name name) {

<span class="fc bfc" id="L55" title="All 2 branches covered.">        if (boost == null) {</span>
<span class="fc" id="L56">            boost = new Boost(sprite, name);</span>
<span class="fc" id="L57">            return boost;</span>
        }
<span class="fc" id="L59">        else throw</span>
            new IllegalStateException(&quot;Boost has already been created&quot;);
    }

    /**
     * Removes the single instance of Boost.
     */
    public static void removeBoost() {

<span class="nc bnc" id="L68" title="All 2 branches missed.">        if (boost != null) {</span>
<span class="nc" id="L69">            boost = null;</span>
        }
<span class="nc" id="L71">    }</span>

    /**
     * Draws the power up.
     * 
     * @param app the PApplet instance to be drawn in
     * 
     * @see GameObject#draw(PApplet)
     */
    @Override
    public void draw(PApplet app) {

<span class="nc bnc" id="L83" title="All 2 branches missed.">        if (isVisible)</span>
<span class="nc" id="L84">            super.draw(app);</span>
<span class="nc" id="L85">    }</span>

    /**
     * @see PowerUp#getProgressBarWidth(int, int)
     */
    @Override
    public double getProgressBarWidth(int barWidth, int frameCount) {

<span class="nc" id="L93">        int frameDuration = Info.FPS * EFFECTDURATION;</span>
<span class="nc" id="L94">        int frameRemaining =</span>
            frameDuration - (frameCount - stateChangeFrameCount);
        
<span class="nc" id="L97">        return (barWidth * ((double) frameRemaining / frameDuration));</span>
    }

    /**
     * @see PowerUp#getRGB()
     */
    @Override
    public int[] getRGB() {

<span class="nc" id="L106">        return RGB;</span>
    }

    /**
     * @see PowerUp#getStateChangeFrameCount()
     */
    @Override
    public int getStateChangeFrameCount() {

<span class="nc" id="L115">        return stateChangeFrameCount;</span>
    }

    /**
     * @see PowerUp#isInEffect()
     */
    @Override
    public boolean isInEffect() {

<span class="nc" id="L124">        return inEffect;</span>
    }

    /**
     * @see PowerUp#setStartingFrameCount(int)
     */
    @Override
    public void setStartingFrameCount(int frameCount) {

<span class="fc" id="L133">        stateChangeFrameCount = frameCount;</span>
<span class="fc" id="L134">    }</span>

    /**
     * @see PowerUp#isTimeToDeactivate(int)
     */
    @Override
    public boolean isTimeToDeactivate(int frameCount) {

<span class="nc" id="L142">        int frameDuration = Info.FPS * EFFECTDURATION;</span>
<span class="nc bnc" id="L143" title="All 6 branches missed.">        return (!isVisible &amp;&amp; inEffect &amp;&amp;</span>
                frameCount - stateChangeFrameCount &gt;= frameDuration);
    }

    /**
     * @see PowerUp#isTimeToDespawn(int)
     */
    @Override
    public boolean isTimeToDespawn(int frameCount) {

<span class="nc" id="L153">        int frameDuration = Info.FPS * SPAWNDURATION;</span>
<span class="nc bnc" id="L154" title="All 6 branches missed.">        return (isVisible &amp;&amp; !inEffect &amp;&amp;</span>
                frameCount - stateChangeFrameCount &gt;= frameDuration);
    }

    /**
     * @see PowerUp#isTimeToSpawn(int)
     */
    @Override
    public boolean isTimeToSpawn(int frameCount) {
        
<span class="fc" id="L164">        int frameDelay = Info.FPS * delay;</span>
<span class="pc bpc" id="L165" title="2 of 6 branches missed.">        return (!isVisible &amp;&amp; !inEffect &amp;&amp;</span>
                frameCount - stateChangeFrameCount &gt;= frameDelay);
    }

    /**
     * @see PowerUp#spawn(TileList, int)
     */
    @Override
    public void spawn(TileList unfilledTiles, int frameCount) {
        
<span class="fc" id="L175">        int tileIndex = rand.nextInt(unfilledTiles.size());</span>
<span class="fc" id="L176">        Tile spawnTile = unfilledTiles.get(tileIndex);</span>
        
<span class="fc" id="L178">        x = spawnTile.getX();</span>
<span class="fc" id="L179">        y = spawnTile.getY();</span>

<span class="fc" id="L181">        isVisible = true;</span>
<span class="fc" id="L182">        stateChangeFrameCount = frameCount;</span>
<span class="fc" id="L183">    }</span>

    /**
     * @see PowerUp#despawn(int)
     */
    @Override
    public void despawn(int frameCount) {

<span class="fc" id="L191">        x = -1;</span>
<span class="fc" id="L192">        y = -1;</span>

<span class="fc" id="L194">        isVisible = false;</span>
<span class="fc" id="L195">        stateChangeFrameCount = frameCount;</span>
<span class="fc" id="L196">        delay = SPAWNDELAY[0] + rand.nextInt(SPAWNDELAY[1] - SPAWNDELAY[0]);</span>
<span class="fc" id="L197">    }</span>

    /**
     * @see PowerUp#activateOn(Entity, Tile, int)
     */
    @Override
    public void activateOn(Entity entity, Tile overlappedTile,
        int frameCount) {

<span class="pc bpc" id="L206" title="1 of 2 branches missed.">        if (!(entity instanceof Player))</span>
<span class="nc" id="L207">            throw new IllegalArgumentException</span>
                (&quot;Argument needs to be an instance of Player&quot;);
        
<span class="fc" id="L210">        Player player = (Player) entity;</span>

<span class="pc bpc" id="L212" title="1 of 2 branches missed.">        if (overlappedTile == null ||</span>
<span class="pc bpc" id="L213" title="1 of 2 branches missed.">            overlappedTile.getName() != Name.GRASS) {</span>
            
<span class="fc" id="L215">            player.setSpeed(Entity.DEFAULTSPEED + 3);</span>
<span class="fc" id="L216">            inEffect = true;</span>
        }
<span class="fc" id="L218">        despawn(frameCount);</span>
<span class="fc" id="L219">    }</span>

    /**
     * @see PowerUp#deactivateOn(Entity)
     */
    @Override
    public void deactivateOn(Entity entity) {

<span class="pc bpc" id="L227" title="1 of 2 branches missed.">        if (!(entity instanceof Player))</span>
<span class="nc" id="L228">            throw new IllegalArgumentException</span>
                (&quot;Argument needs to be an instance of Player&quot;);

<span class="fc" id="L231">        Player player = (Player) entity;</span>
<span class="fc" id="L232">        player.setSpeed(Entity.DEFAULTSPEED);</span>

<span class="fc" id="L234">        inEffect = false;</span>
<span class="fc" id="L235">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>