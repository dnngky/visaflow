<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Shield.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">lawnlayer</a> &gt; <a href="index.source.html" class="el_package">lawnlayer</a> &gt; <span class="el_source">Shield.java</span></div><h1>Shield.java</h1><pre class="source lang-java linenums">package lawnlayer;

import lawnlayer.Info.Name;
import processing.core.PApplet;
import processing.core.PImage;

/**
 * A singleton subclass of GameObject and implementation of PowerUp.
 * This power up turns the Player invincible for a brief
 * period of time. All Enemy types will bounce off the
 * Player and path will not turn red upon collision.
 */
public class Shield extends GameObject implements PowerUp {
    
<span class="fc" id="L15">    private static Shield shield = null;</span>

    private static final int EFFECTDURATION  = 6;
    private static final int SPAWNDURATION = 7;
<span class="fc" id="L19">    private static final int[] SPAWNDELAY = new int[] { 3, 10 };</span>
<span class="fc" id="L20">    private static final int[] RGB = new int[] { 236, 236, 236 };</span>

    private boolean isVisible;
    private boolean inEffect;
    private int delay;
    private int stateChangeFrameCount;
    
    /**
     * Initialises the Shield power up with the specified sprite and name.
     * 
     * @param sprite the PImage sprite of the boost
     * @param name the name of the boost
     */
    private Shield(PImage sprite, Name name) {

<span class="fc" id="L35">        super(sprite, name);</span>
        
<span class="fc" id="L37">        delay = SPAWNDELAY[0] + rand.nextInt(SPAWNDELAY[1] - SPAWNDELAY[0]);</span>
<span class="fc" id="L38">        isVisible = false;</span>
<span class="fc" id="L39">        inEffect = false;</span>
<span class="fc" id="L40">        stateChangeFrameCount = 0;</span>
<span class="fc" id="L41">    }</span>

    /**
     * A 'static constructor' for Player. If multiple instantiation of Player
     * is attempted, an exception is thrown.
     * 
     * @param sprite the PImage sprite of the Boost
     * @param name the name of the boost
     * @return a single instance of Player
     * 
     * @see #Shield(PImage, Name)
     * @throws IllegalStateException if an instance already exists
     */
    public static Shield createShield(PImage sprite, Name name) {

<span class="fc bfc" id="L56" title="All 2 branches covered.">        if (shield == null) {</span>
<span class="fc" id="L57">            shield = new Shield(sprite, name);</span>
<span class="fc" id="L58">            return shield;</span>
        }
<span class="fc" id="L60">        else throw</span>
            new IllegalStateException(&quot;Shield has already been created&quot;);
    }

    /**
     * Removes the single instance of Shield.
     */
    public static void removeShield() {

<span class="nc bnc" id="L69" title="All 2 branches missed.">        if (shield != null) {</span>
<span class="nc" id="L70">            shield = null;</span>
        }
<span class="nc" id="L72">    }</span>

    /**
     * Draws the power up.
     * 
     * @param app the PApplet instance to be drawn in
     * 
     * @see GameObject#draw(PApplet)
     */
    @Override
    public void draw(PApplet app) {

<span class="nc bnc" id="L84" title="All 2 branches missed.">        if (isVisible)</span>
<span class="nc" id="L85">            super.draw(app);</span>
<span class="nc" id="L86">    }</span>

    /**
     * @see PowerUp#getProgressBarWidth(int, int)
     */
    @Override
    public double getProgressBarWidth(int barWidth, int frameCount) {

<span class="nc" id="L94">        int frameDuration = Info.FPS * EFFECTDURATION;</span>
<span class="nc" id="L95">        int frameRemaining =</span>
            frameDuration - (frameCount - stateChangeFrameCount);
        
<span class="nc" id="L98">        return (barWidth * ((double) frameRemaining / frameDuration));</span>
    }

    /**
     * @see PowerUp#getRGB()
     */
    @Override
    public int[] getRGB() {

<span class="nc" id="L107">        return RGB;</span>
    }

    /**
     * @see PowerUp#getStateChangeFrameCount()
     */
    @Override
    public int getStateChangeFrameCount() {

<span class="nc" id="L116">        return stateChangeFrameCount;</span>
    }

    /**
     * @see PowerUp#isInEffect()
     */
    @Override
    public boolean isInEffect() {

<span class="fc" id="L125">        return inEffect;</span>
    }

    /**
     * @see PowerUp#setStartingFrameCount(int)
     */
    @Override
    public void setStartingFrameCount(int frameCount) {

<span class="fc" id="L134">        stateChangeFrameCount = frameCount;</span>
<span class="fc" id="L135">    }</span>

    /**
     * @see PowerUp#isTimeToDeactivate(int)
     */
    @Override
    public boolean isTimeToDeactivate(int frameCount) {

<span class="nc" id="L143">        int frameDuration = Info.FPS * EFFECTDURATION;</span>
<span class="nc bnc" id="L144" title="All 6 branches missed.">        return (!isVisible &amp;&amp; inEffect &amp;&amp;</span>
                frameCount - stateChangeFrameCount &gt;= frameDuration);
    }

    /**
     * @see PowerUp#isTimeToDespawn(int)
     */
    @Override
    public boolean isTimeToDespawn(int frameCount) {

<span class="nc" id="L154">        int frameDuration = Info.FPS * SPAWNDURATION;</span>
<span class="nc bnc" id="L155" title="All 6 branches missed.">        return (isVisible &amp;&amp; !inEffect &amp;&amp;</span>
                frameCount - stateChangeFrameCount &gt;= frameDuration);
    }

    /**
     * @see PowerUp#isTimeToSpawn(int)
     */
    @Override
    public boolean isTimeToSpawn(int frameCount) {
        
<span class="fc" id="L165">        int frameDelay = Info.FPS * delay;</span>
<span class="pc bpc" id="L166" title="2 of 6 branches missed.">        return (!isVisible &amp;&amp; !inEffect &amp;&amp;</span>
                frameCount - stateChangeFrameCount &gt;= frameDelay);
    }

    /**
     * @see PowerUp#spawn(TileList, int)
     */
    @Override
    public void spawn(TileList unfilledTiles, int frameCount) {
        
<span class="fc" id="L176">        int tileIndex = rand.nextInt(unfilledTiles.size());</span>
<span class="fc" id="L177">        Tile spawnTile = unfilledTiles.get(tileIndex);</span>
        
<span class="fc" id="L179">        x = spawnTile.getX();</span>
<span class="fc" id="L180">        y = spawnTile.getY();</span>

<span class="fc" id="L182">        isVisible = true;</span>
<span class="fc" id="L183">        stateChangeFrameCount = frameCount;</span>
<span class="fc" id="L184">    }</span>

    /**
     * @see PowerUp#despawn(int)
     */
    @Override
    public void despawn(int frameCount) {

<span class="fc" id="L192">        x = -1;</span>
<span class="fc" id="L193">        y = -1;</span>

<span class="fc" id="L195">        isVisible = false;</span>
<span class="fc" id="L196">        stateChangeFrameCount = frameCount;</span>
<span class="fc" id="L197">        delay = SPAWNDELAY[0] + rand.nextInt(SPAWNDELAY[1] - SPAWNDELAY[0]);</span>
<span class="fc" id="L198">    }</span>

    /**
     * @see PowerUp#activateOn(Entity, Tile, int)
     */
    @Override
    public void activateOn(Entity entity, Tile overlappedTile,
        int frameCount) {

<span class="pc bpc" id="L207" title="1 of 2 branches missed.">        if (!(entity instanceof Player))</span>
<span class="nc" id="L208">            throw new IllegalArgumentException</span>
                (&quot;Argument needs to be an instance of Player&quot;);

<span class="fc" id="L211">        Player player = (Player) entity;</span>

<span class="pc bpc" id="L213" title="1 of 2 branches missed.">        if (overlappedTile == null ||</span>
<span class="pc bpc" id="L214" title="1 of 2 branches missed.">            overlappedTile.getName() != Name.GRASS) {</span>
            
<span class="fc" id="L216">            player.enableShield();</span>
<span class="fc" id="L217">            inEffect = true;</span>
        }
<span class="fc" id="L219">        despawn(frameCount);</span>
<span class="fc" id="L220">    }</span>

    /**
     * @see PowerUp#deactivateOn(Entity)
     */
    @Override
    public void deactivateOn(Entity entity) {

<span class="pc bpc" id="L228" title="1 of 2 branches missed.">        if (!(entity instanceof Player))</span>
<span class="nc" id="L229">            throw new IllegalArgumentException</span>
                (&quot;Argument needs to be an instance of Player&quot;);

<span class="fc" id="L232">        Player player = (Player) entity;</span>
<span class="fc" id="L233">        player.disableShield();</span>

<span class="fc" id="L235">        inEffect = false;</span>
<span class="fc" id="L236">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>